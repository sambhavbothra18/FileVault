<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>My Files</h1>
  <%= link_to "Upload New File", new_uploaded_file_path, class: "btn btn-primary" %>
</div>

<% if @uploaded_files.any? %>
  <div class="row">
    <% @uploaded_files.each do |file| %>
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">
              <i class="bi bi-file-earmark"></i>
              <%= file.title %>
            </h5>
            
            <% if file.description.present? %>
              <p class="card-text text-muted small"><%= truncate(file.description, length: 100) %></p>
            <% end %>
            
            <div class="small text-muted mb-3">
              <div><strong>File:</strong> <%= file.filename %></div>
              <div><strong>Size:</strong> <%= file.formatted_file_size %></div>
              <div><strong>Type:</strong> <%= file.file_type %></div>
              <div><strong>Uploaded:</strong> <%= file.created_at.strftime('%B %d, %Y at %I:%M %p') %></div>
              
              <div class="mt-2">
                <% if file.is_public? %>
                  <span class="badge bg-success">
                    <i class="bi bi-globe"></i> Public
                  </span>
                <% else %>
                  <span class="badge bg-secondary">
                    <i class="bi bi-lock"></i> Private
                  </span>
                <% end %>
              </div>
            </div>
          </div>
          
          <div class="card-footer bg-light">
            <div class="btn-group w-100" role="group">
              <%= link_to file, class: "btn btn-sm btn-outline-primary" do %>
                <i class="bi bi-eye"></i> View
              <% end %>
              
              <%= link_to download_uploaded_file_path(file), class: "btn btn-sm btn-outline-success" do %>
                <i class="bi bi-download"></i> Download
              <% end %>
              
             <%= form_with url: toggle_public_uploaded_file_path(file), method: :patch, class: "d-inline" do %>
                <button type="submit" class="btn btn-sm btn-outline-info">
                    <% if file.is_public? %>
                    <i class="bi bi-lock"></i> Make Private
                    <% else %>
                    <i class="bi bi-globe"></i> Make Public
                    <% end %>
                </button>
             <% end %>
              
              <%= link_to file, method: :delete, 
                  confirm: "Are you sure you want to delete this file?", 
                  class: "btn btn-sm btn-outline-danger" do %>
                <i class="bi bi-trash"></i> Delete
              <% end %>
            </div>
            
            <% if file.is_public? && file.public_share_url %>
              <div class="mt-2">
                <div class="input-group input-group-sm">
                  <input type="text" class="form-control" value="<%= file.public_share_url %>" readonly id="share-url-<%= file.id %>">
                  <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('share-url-<%= file.id %>')">
                    <i class="bi bi-clipboard"></i>
                  </button>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-5">
    <i class="bi bi-cloud-upload display-1 text-muted"></i>
    <h3 class="mt-3">No files uploaded yet</h3>
    <p class="text-muted">Upload your first file to get started</p>
    <%= link_to "Upload File", new_uploaded_file_path, class: "btn btn-primary btn-lg" %>
  </div>
<% end %>

<script>
function copyToClipboard(elementId) {
  const input = document.getElementById(elementId);
  input.select();
  document.execCommand('copy');
  
  // Show feedback
  const button = input.nextElementSibling;
  const originalText = button.innerHTML;
  button.innerHTML = '<i class="bi bi-check"></i>';
  setTimeout(() => {
    button.innerHTML = originalText;
  }, 2000);
}
</script>