<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="mb-0"><%= @uploaded_file.title %></h2>
        <div>
          <% if @uploaded_file.is_public? %>
            <span class="badge bg-success fs-6">
              <i class="bi bi-globe"></i> Public
            </span>
          <% else %>
            <span class="badge bg-secondary fs-6">
              <i class="bi bi-lock"></i> Private
            </span>
          <% end %>
        </div>
      </div>
      
      <div class="card-body">
        <% if @uploaded_file.description.present? %>
          <div class="mb-4">
            <h5>Description</h5>
            <p class="text-muted"><%= simple_format(@uploaded_file.description) %></p>
          </div>
        <% end %>

        <div class="row mb-4">
          <div class="col-md-6">
            <h6>File Details</h6>
            <table class="table table-sm">
              <tr>
                <td><strong>Filename:</strong></td>
                <td><%= @uploaded_file.filename %></td>
              </tr>
              <tr>
                <td><strong>File Size:</strong></td>
                <td><%= @uploaded_file.formatted_file_size %></td>
              </tr>
              <tr>
                <td><strong>File Type:</strong></td>
                <td><%= @uploaded_file.file_type %></td>
              </tr>
              <tr>
                <td><strong>Uploaded:</strong></td>
                <td><%= @uploaded_file.created_at.strftime('%B %d, %Y at %I:%M %p') %></td>
              </tr>
            </table>
          </div>
          
          <div class="col-md-6">
            <h6>File Preview</h6>
            <div class="border rounded p-3 text-center bg-light">
              <% if @uploaded_file.vault_file.content_type&.start_with?('image/') %>
                <%= image_tag @uploaded_file.vault_file, class: "img-fluid", style: "max-height: 200px;" %>
              <% else %>
                <i class="bi bi-file-earmark display-3 text-muted"></i>
                <div class="mt-2 text-muted">
                  <%= @uploaded_file.file_type || "Unknown file type" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <% if @uploaded_file.is_public? && @uploaded_file.public_share_url %>
          <div class="mb-4">
            <h6>Public Share Link</h6>
            <div class="input-group">
              <input type="text" class="form-control" value="<%= @uploaded_file.public_share_url %>" readonly id="shareUrl">
              <button class="btn btn-outline-secondary" type="button" onclick="copyShareUrl()">
                <i class="bi bi-clipboard"></i> Copy
              </button>
            </div>
            <small class="text-muted">Anyone with this link can view and download your file.</small>
          </div>
        <% end %>
      </div>

      <div class="card-footer">
        <div class="btn-group me-2">
          <%= link_to download_uploaded_file_path(@uploaded_file), class: "btn btn-success" do %>
            <i class="bi bi-download"></i> Download
          <% end %>
          
          <%= link_to edit_uploaded_file_path(@uploaded_file), class: "btn btn-primary" do %>
            <i class="bi bi-pencil"></i> Edit Details
          <% end %>
        </div>

        <div class="btn-group me-2">
          <%= link_to toggle_public_uploaded_file_path(@uploaded_file), method: :patch, class: "btn btn-outline-info" do %>
            <% if @uploaded_file.is_public? %>
              <i class="bi bi-lock"></i> Make Private
            <% else %>
              <i class="bi bi-globe"></i> Make Public
            <% end %>
          <% end %>
        </div>

        <div class="btn-group">
          <%= link_to @uploaded_file, method: :delete, 
              confirm: "Are you sure you want to delete this file? This action cannot be undone.", 
              class: "btn btn-danger" do %>
            <i class="bi bi-trash"></i> Delete
          <% end %>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Actions</h5>
      </div>
      <div class="card-body">
        <%= link_to uploaded_files_path, class: "btn btn-outline-secondary w-100 mb-2" do %>
          <i class="bi bi-arrow-left"></i> Back to My Files
        <% end %>
        
        <%= link_to new_uploaded_file_path, class: "btn btn-outline-primary w-100" do %>
          <i class="bi bi-plus"></i> Upload Another File
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
function copyShareUrl() {
  const input = document.getElementById('shareUrl');
  input.select();
  document.execCommand('copy');
  
  // Show success feedback
  const button = input.nextElementSibling;
  const originalText = button.innerHTML;
  button.innerHTML = '<i class="bi bi-check"></i> Copied!';
  button.classList.remove('btn-outline-secondary');
  button.classList.add('btn-success');
  
  setTimeout(() => {
    button.innerHTML = originalText;
    button.classList.remove('btn-success');
    button.classList.add('btn-outline-secondary');
  }, 2000);
}
</script>